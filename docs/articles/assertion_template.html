<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>assertable Template • assertable</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">assertable</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>assertable Template</h1>
                        <h4 class="author">Grant Nguyen</h4>
            
            <h4 class="date">2017-05-09</h4>
          </div>

    
    
<div class="contents">
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>We will use the CO2 dataset, which has 64 rows and 5 columns of data from an experiment related to the cold tolerances of plants. First, we take in the CO2 dataset and save the whole dataset three times into three separate csv files as data/file_#.csv, with a unique id_var.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="dv">1</span>:<span class="dv">3</span>) {
  data &lt;-<span class="st"> </span>CO2
  data$id_var &lt;-<span class="st"> </span>i
  <span class="kw">write.csv</span>(data,<span class="dt">file=</span><span class="kw">paste0</span>(<span class="st">"../data/file_"</span>,i,<span class="st">".csv"</span>),<span class="dt">row.names=</span>F)
}</code></pre></div>
</div>
<div id="file-check-and-import" class="section level2">
<h2 class="hasAnchor">
<a href="#file-check-and-import" class="anchor"></a>File Check and Import</h2>
<p>First, use check_files to make sure the files exist. We can use the system.file command to locate them within the assertable package. Then, run import_files to bring them in. We’ll call the combined data object master_data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filenames &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"file_"</span>,<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>),<span class="st">".csv"</span>)
filenames &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, filenames, <span class="dt">package =</span> <span class="st">"assertable"</span>)

filenames</code></pre></div>
<pre><code>## [1] "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/assertable/extdata/file_1.csv"
## [2] "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/assertable/extdata/file_2.csv"
## [3] "/Library/Frameworks/R.framework/Versions/3.3/Resources/library/assertable/extdata/file_3.csv"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/check_files.html">check_files</a></span>(filenames)</code></pre></div>
<pre><code>## [1] "All results are present"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">master_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/import_files.html">import_files</a></span>(filenames,<span class="dt">FUN=</span>fread)</code></pre></div>
<pre><code>## [1] "All results are present"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(master_data)</code></pre></div>
<pre><code>##    Plant   Type  Treatment conc uptake id_var
## 1:   Qn1 Quebec nonchilled   95   16.0      1
## 2:   Qn1 Quebec nonchilled  175   30.4      1
## 3:   Qn1 Quebec nonchilled  250   34.8      1
## 4:   Qn1 Quebec nonchilled  350   37.2      1
## 5:   Qn1 Quebec nonchilled  500   35.3      1
## 6:   Qn1 Quebec nonchilled  675   39.2      1</code></pre>
</div>
<div id="checking-dimensions" class="section level2">
<h2 class="hasAnchor">
<a href="#checking-dimensions" class="anchor"></a>Checking Dimensions</h2>
<p>This dataset should have 84 * 3 rows, and six columns: Plant, Type, Treatment, conc, uptake, and id_var.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_nrows.html">assert_nrows</a></span>(master_data,(<span class="dv">84</span>*<span class="dv">3</span>))</code></pre></div>
<pre><code>## [1] "All rows present"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_colnames.html">assert_colnames</a></span>(master_data,<span class="kw">c</span>(<span class="st">"plant"</span>,<span class="st">"type"</span>,<span class="st">"treatment"</span>,<span class="st">"conc"</span>,<span class="st">"uptake"</span>,<span class="st">"id_var"</span>))</code></pre></div>
<pre><code>## Error in assert_colnames(master_data, c("plant", "type", "treatment", : These columns exist in colnames but not in your dataframe: plant type treatment and these exist in your dataframe but not in colnames: Plant Type Treatment</code></pre>
<p>Oops, forgot to capitalize the column names. Trying again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_nrows.html">assert_nrows</a></span>(master_data,(<span class="dv">84</span>*<span class="dv">3</span>))</code></pre></div>
<pre><code>## [1] "All rows present"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_colnames.html">assert_colnames</a></span>(master_data,<span class="kw">c</span>(<span class="st">"Plant"</span>,<span class="st">"Type"</span>,<span class="st">"Treatment"</span>,<span class="st">"conc"</span>,<span class="st">"uptake"</span>,<span class="st">"id_var"</span>))</code></pre></div>
<pre><code>## [1] "All column names present"</code></pre>
</div>
<div id="checking-ids" class="section level2">
<h2 class="hasAnchor">
<a href="#checking-ids" class="anchor"></a>Checking IDs</h2>
<p>We believe the dataset should be unique by Plant, conc, and id_var (where id_var just represents the replication number of the dataset). Let’s check this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plants &lt;-<span class="st"> </span><span class="kw">unique</span>(master_data$Plant)
concs &lt;-<span class="st"> </span><span class="kw">unique</span>(master_data$conc)
id_vars &lt;-<span class="st"> </span><span class="kw">unique</span>(master_data$id_var)

id_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Plant=</span>plants, <span class="dt">conc=</span>concs, <span class="dt">id_var=</span>id_vars)
<span class="kw"><a href="../reference/assert_ids.html">assert_ids</a></span>(master_data,id_list)</code></pre></div>
<pre><code>## [1] "Data is identified by id_vars: Plant conc id_var"</code></pre>
<p>Now, let’s make sure that there are only two values in Type: Quebec and Mississippi. Let’s also make sure that uptake and conc are more than 0 and less than 1500.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_values.html">assert_values</a></span>(master_data, <span class="dt">colnames =</span> <span class="st">"Type"</span>, <span class="dt">test=</span><span class="st">"in"</span>, <span class="dt">test_val =</span> <span class="kw">c</span>(<span class="st">"Quebec"</span>,<span class="st">"Mississippi"</span>))</code></pre></div>
<pre><code>## [1] "Variable Type passed in test"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_values.html">assert_values</a></span>(master_data, <span class="dt">colnames =</span> <span class="kw">c</span>(<span class="st">"uptake"</span>,<span class="st">"conc"</span>), <span class="dt">test=</span><span class="st">"gt"</span>, <span class="dt">test_val =</span> <span class="dv">0</span>)</code></pre></div>
<pre><code>## [1] "Variable uptake passed gt test"
## [1] "Variable conc passed gt test"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_values.html">assert_values</a></span>(master_data, <span class="dt">colnames =</span> <span class="kw">c</span>(<span class="st">"uptake"</span>,<span class="st">"conc"</span>), <span class="dt">test=</span><span class="st">"lt"</span>, <span class="dt">test_val =</span> <span class="dv">1500</span>)</code></pre></div>
<pre><code>## [1] "Variable uptake passed lt test"
## [1] "Variable conc passed lt test"</code></pre>
<p>Finally, let’s assert that all values of conc must be at least 6 times the value of uptake</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_values.html">assert_values</a></span>(master_data, <span class="dt">colnames =</span> <span class="st">"conc"</span>, <span class="dt">test=</span><span class="st">"gt"</span>, <span class="dt">test_val =</span> master_data$uptake *<span class="st"> </span><span class="dv">6</span>)</code></pre></div>
<pre><code>##     Plant   Type  Treatment conc uptake id_var
##  1:   Qn1 Quebec nonchilled   95   16.0      1
##  2:   Qn1 Quebec nonchilled  175   30.4      1
##  3:   Qn3 Quebec nonchilled   95   16.2      1
##  4:   Qn3 Quebec nonchilled  175   32.4      1
##  5:   Qn1 Quebec nonchilled   95   16.0      2
##  6:   Qn1 Quebec nonchilled  175   30.4      2
##  7:   Qn3 Quebec nonchilled   95   16.2      2
##  8:   Qn3 Quebec nonchilled  175   32.4      2
##  9:   Qn1 Quebec nonchilled   95   16.0      3
## 10:   Qn1 Quebec nonchilled  175   30.4      3
## 11:   Qn3 Quebec nonchilled   95   16.2      3
## 12:   Qn3 Quebec nonchilled  175   32.4      3</code></pre>
<pre><code>## Error in assert_values(master_data, colnames = "conc", test = "gt", test_val = master_data$uptake * : 12 Rows for variable conc not more than the test value(s) in the dataset above</code></pre>
<p>Bummer. Let’s finally do some subsetting of our data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_data &lt;-<span class="st"> </span>master_data[master_data$Type ==<span class="st"> "Quebec"</span> &amp;<span class="st"> </span>master_data$Plant %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"Qn2"</span>,<span class="st">"Qn3"</span>) &amp;<span class="st"> </span>uptake &gt;<span class="st"> </span><span class="dv">20</span>,]</code></pre></div>
<p>Now, let’s see if our values of concs can uniquely identify our observations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/assert_ids.html">assert_ids</a></span>(new_data, <span class="kw">list</span>(<span class="dt">Plant=</span><span class="kw">c</span>(<span class="st">"Qn2"</span>,<span class="st">"Qn3"</span>), <span class="dt">conc=</span>concs))</code></pre></div>
<pre><code>##    Plant conc
## 1:   Qn2   95
## 2:   Qn3   95</code></pre>
<pre><code>## Error in assert_ids(new_data, list(Plant = c("Qn2", "Qn3"), conc = concs)): The above combinations of id variables do not exist in your dataset</code></pre>
<p>Rough, let’s take 95 out of our concs level and try it again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_concs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">175</span>,<span class="dv">250</span>,<span class="dv">350</span>,<span class="dv">500</span>,<span class="dv">675</span>,<span class="dv">1000</span>)
<span class="kw"><a href="../reference/assert_ids.html">assert_ids</a></span>(new_data, <span class="kw">list</span>(<span class="dt">Plant=</span><span class="kw">c</span>(<span class="st">"Qn2"</span>,<span class="st">"Qn3"</span>),<span class="dt">conc=</span>new_concs))</code></pre></div>
<pre><code>##     Plant conc n_duplicates
##  1:   Qn2  175            3
##  2:   Qn2  250            3
##  3:   Qn2  350            3
##  4:   Qn2  500            3
##  5:   Qn2  675            3
##  6:   Qn2 1000            3
##  7:   Qn3  175            3
##  8:   Qn3  250            3
##  9:   Qn3  350            3
## 10:   Qn3  500            3
## 11:   Qn3  675            3
## 12:   Qn3 1000            3</code></pre>
<pre><code>## Error in assert_ids(new_data, list(Plant = c("Qn2", "Qn3"), conc = new_concs)): These combinations of id variables have n_duplicates duplicate observations per combination (36 total duplicates)</code></pre>
<p>Let’s first get the actual rows and look at them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_concs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">175</span>,<span class="dv">250</span>,<span class="dv">350</span>,<span class="dv">500</span>,<span class="dv">675</span>,<span class="dv">1000</span>)
vetting_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/assert_ids.html">assert_ids</a></span>(new_data, <span class="kw">list</span>(<span class="dt">Plant=</span><span class="kw">c</span>(<span class="st">"Qn2"</span>,<span class="st">"Qn3"</span>),<span class="dt">conc=</span>new_concs), 
                           <span class="dt">ids_only=</span>F, <span class="dt">warn_only=</span>T)</code></pre></div>
<pre><code>## Warning in assert_ids(new_data, list(Plant = c("Qn2", "Qn3"), conc
## = new_concs), : These rows of data are all of the observations with
## duplicated id_vars, and have n_duplicates duplicate observations per
## combination of id_varnames (36 total duplicates)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">head</span>(vetting_data))</code></pre></div>
<pre><code>##    Plant conc   Type  Treatment uptake id_var n_duplicates duplicate_id
## 1:   Qn2  175 Quebec nonchilled   27.3      1            3            1
## 2:   Qn2  175 Quebec nonchilled   27.3      2            3            2
## 3:   Qn2  175 Quebec nonchilled   27.3      3            3            3
## 4:   Qn2  250 Quebec nonchilled   37.1      1            3            1
## 5:   Qn2  250 Quebec nonchilled   37.1      2            3            2
## 6:   Qn2  250 Quebec nonchilled   37.1      3            3            3</code></pre>
<p>Hmm, we forgot to include the values of id_var in the actual id_vars argument. Now, let’s try it the last time with the id_var character vector included.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_concs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">175</span>,<span class="dv">250</span>,<span class="dv">350</span>,<span class="dv">500</span>,<span class="dv">675</span>,<span class="dv">1000</span>)
<span class="kw"><a href="../reference/assert_ids.html">assert_ids</a></span>(new_data, <span class="kw">list</span>(<span class="dt">Plant=</span><span class="kw">c</span>(<span class="st">"Qn2"</span>,<span class="st">"Qn3"</span>), <span class="dt">conc=</span>new_concs, <span class="dt">id_var=</span>id_vars))</code></pre></div>
<pre><code>## [1] "Data is identified by id_vars: Plant conc id_var"</code></pre>
<p>Awesome! Now you’re a data wizard!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data">Data</a></li>
      <li><a href="#file-check-and-import">File Check and Import</a></li>
      <li><a href="#checking-dimensions">Checking Dimensions</a></li>
      <li><a href="#checking-ids">Checking IDs</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Grant Nguyen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
